<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="606px" preserveAspectRatio="none" style="width:1318px;height:606px;background:#FFFFFF;" version="1.1" viewBox="0 0 1318 606" width="1318px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="485.8594" style="stroke:#181818;stroke-width:1.0;" width="10" x="163.5" y="67.4297"/><rect fill="#FFFFFF" height="385.4609" style="stroke:#181818;stroke-width:1.0;" width="10" x="334.5" y="138.6953"/><rect fill="#FFFFFF" height="242.9297" style="stroke:#181818;stroke-width:1.0;" width="10" x="642.5" y="252.0938"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1059" y="436.7578"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="25" x2="25" y1="36.2969" y2="571.2891"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="168" x2="168" y1="36.2969" y2="571.2891"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="339" x2="339" y1="36.2969" y2="571.2891"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="647.5" x2="647.5" y1="36.2969" y2="571.2891"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="963" x2="963" y1="36.2969" y2="571.2891"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1064" x2="1064" y1="36.2969" y2="571.2891"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1164" x2="1164" y1="36.2969" y2="571.2891"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="1263" x2="1263" y1="36.2969" y2="571.2891"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="41" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="12" y="24.9951">SPA</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="41" x="5" y="570.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="12" y="590.2842">SPA</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="69" x="134" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="141" y="24.9951">MPT API</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="69" x="134" y="570.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="141" y="590.2842">MPT API</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="113" x="283" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="290" y="24.9951">UserController</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="113" x="283" y="570.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="290" y="590.2842">UserController</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96" x="599.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="606.5" y="24.9951">UserService</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96" x="599.5" y="570.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="606.5" y="590.2842">UserService</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="83" x="922" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="929" y="24.9951">UserRepo</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="83" x="922" y="570.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="929" y="590.2842">UserRepo</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="98" x="1015" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="1022" y="24.9951">UserMapper</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="98" x="1015" y="570.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="1022" y="590.2842">UserMapper</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="82" x="1123" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="1130" y="24.9951">RoleRepo</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="82" x="1123" y="570.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="68" x="1130" y="590.2842">RoleRepo</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="97" x="1215" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="1222" y="24.9951">RoleMapper</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="97" x="1215" y="570.2891"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="83" x="1222" y="590.2842">RoleMapper</text><rect fill="#FFFFFF" height="485.8594" style="stroke:#181818;stroke-width:1.0;" width="10" x="163.5" y="67.4297"/><rect fill="#FFFFFF" height="385.4609" style="stroke:#181818;stroke-width:1.0;" width="10" x="334.5" y="138.6953"/><rect fill="#FFFFFF" height="242.9297" style="stroke:#181818;stroke-width:1.0;" width="10" x="642.5" y="252.0938"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="1059" y="436.7578"/><polygon fill="#181818" points="151.5,63.4297,161.5,67.4297,151.5,71.4297,155.5,67.4297" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="25.5" x2="157.5" y1="67.4297" y2="67.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="119" x="32.5" y="62.3638">PATCH(/api/users/)</text><line style="stroke:#181818;stroke-width:1.0;" x1="173.5" x2="215.5" y1="96.5625" y2="96.5625"/><line style="stroke:#181818;stroke-width:1.0;" x1="215.5" x2="215.5" y1="96.5625" y2="109.5625"/><line style="stroke:#181818;stroke-width:1.0;" x1="174.5" x2="215.5" y1="109.5625" y2="109.5625"/><polygon fill="#181818" points="184.5,105.5625,174.5,109.5625,184.5,113.5625,180.5,109.5625" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="180.5" y="91.4966">auth middleware</text><polygon fill="#181818" points="322.5,134.6953,332.5,138.6953,322.5,142.6953,326.5,138.6953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="173.5" x2="328.5" y1="138.6953" y2="138.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="142" x="180.5" y="133.6294">UpdateMyProfile(user)</text><line style="stroke:#181818;stroke-width:1.0;" x1="344.5" x2="386.5" y1="167.8281" y2="167.8281"/><line style="stroke:#181818;stroke-width:1.0;" x1="386.5" x2="386.5" y1="167.8281" y2="180.8281"/><line style="stroke:#181818;stroke-width:1.0;" x1="345.5" x2="386.5" y1="180.8281" y2="180.8281"/><polygon fill="#181818" points="355.5,176.8281,345.5,180.8281,355.5,184.8281,351.5,180.8281" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="351.5" y="162.7622">permissions middleware</text><line style="stroke:#181818;stroke-width:1.0;" x1="344.5" x2="386.5" y1="209.9609" y2="209.9609"/><line style="stroke:#181818;stroke-width:1.0;" x1="386.5" x2="386.5" y1="209.9609" y2="222.9609"/><line style="stroke:#181818;stroke-width:1.0;" x1="345.5" x2="386.5" y1="222.9609" y2="222.9609"/><polygon fill="#181818" points="355.5,218.9609,345.5,222.9609,355.5,226.9609,351.5,222.9609" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="137" x="351.5" y="204.895">get current user from</text><polygon fill="#181818" points="630.5,248.0938,640.5,252.0938,630.5,256.0938,634.5,252.0938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="344.5" x2="636.5" y1="252.0938" y2="252.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="279" x="351.5" y="247.0278">UpdateMyProfileAsync(user, currentUser.Id)</text><line style="stroke:#181818;stroke-width:1.0;" x1="652.5" x2="694.5" y1="281.2266" y2="281.2266"/><line style="stroke:#181818;stroke-width:1.0;" x1="694.5" x2="694.5" y1="281.2266" y2="294.2266"/><line style="stroke:#181818;stroke-width:1.0;" x1="653.5" x2="694.5" y1="294.2266" y2="294.2266"/><polygon fill="#181818" points="663.5,290.2266,653.5,294.2266,663.5,298.2266,659.5,294.2266" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="659.5" y="276.1606">GetByIdAsync(id)</text><line style="stroke:#181818;stroke-width:1.0;" x1="652.5" x2="694.5" y1="323.3594" y2="323.3594"/><line style="stroke:#181818;stroke-width:1.0;" x1="694.5" x2="694.5" y1="323.3594" y2="336.3594"/><line style="stroke:#181818;stroke-width:1.0;" x1="653.5" x2="694.5" y1="336.3594" y2="336.3594"/><polygon fill="#181818" points="663.5,332.3594,653.5,336.3594,663.5,340.3594,659.5,336.3594" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="292" x="659.5" y="318.2935">check if user is valid (exists, active, approved)</text><line style="stroke:#181818;stroke-width:1.0;" x1="652.5" x2="694.5" y1="365.4922" y2="365.4922"/><line style="stroke:#181818;stroke-width:1.0;" x1="694.5" x2="694.5" y1="365.4922" y2="378.4922"/><line style="stroke:#181818;stroke-width:1.0;" x1="653.5" x2="694.5" y1="378.4922" y2="378.4922"/><polygon fill="#181818" points="663.5,374.4922,653.5,378.4922,663.5,382.4922,659.5,378.4922" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="114" x="659.5" y="360.4263">update user fields</text><polygon fill="#181818" points="951.5,403.625,961.5,407.625,951.5,411.625,955.5,407.625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="652.5" x2="957.5" y1="407.625" y2="407.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="127" x="659.5" y="402.5591">CommitAsync(user)</text><polygon fill="#181818" points="1047,432.7578,1057,436.7578,1047,440.7578,1051,436.7578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="652.5" x2="1053" y1="436.7578" y2="436.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="115" x="659.5" y="431.6919">ToProfileDto(user)</text><polygon fill="#181818" points="663.5,461.8906,653.5,465.8906,663.5,469.8906,659.5,465.8906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="657.5" x2="1063" y1="465.8906" y2="465.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="669.5" y="460.8247">userDto</text><polygon fill="#181818" points="355.5,491.0234,345.5,495.0234,355.5,499.0234,351.5,495.0234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="349.5" x2="646.5" y1="495.0234" y2="495.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="361.5" y="489.9575">userDto</text><polygon fill="#181818" points="184.5,520.1563,174.5,524.1563,184.5,528.1563,180.5,524.1563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="178.5" x2="338.5" y1="524.1563" y2="524.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="190.5" y="519.0903">userDto</text><polygon fill="#181818" points="36.5,549.2891,26.5,553.2891,36.5,557.2891,32.5,553.2891" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;stroke-dasharray:2.0,2.0;" x1="30.5" x2="167.5" y1="553.2891" y2="553.2891"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="42.5" y="548.2231">userDto</text><!--MD5=[667f9581c93b1b8920a018cb611df26b]
@startuml
participant SPA
participant "MPT API" as API
participant "UserController" as Ctrl
participant "UserService" as Srv
participant "UserRepo" as Repo
participant "UserMapper" as Map
participant "RoleRepo" as rr
participant "RoleMapper" as rm



SPA -> API: PATCH(/api/users/)
activate API

API -> API: auth middleware

API -> Ctrl: UpdateMyProfile(user)
activate Ctrl
Ctrl -> Ctrl: permissions middleware

Ctrl -> Ctrl: get current user from

Ctrl -> Srv: UpdateMyProfileAsync(user, currentUser.Id)
activate Srv

Srv -> Srv: GetByIdAsync(id)

Srv -> Srv: check if user is valid (exists, active, approved)
Srv -> Srv: update user fields

Srv -> Repo: CommitAsync(user)
Srv -> Map: ToProfileDto(user)
activate Map
Map - -> Srv: userDto
deactivate Map

Srv - -> Ctrl: userDto
deactivate Srv

Ctrl - -> API: userDto
deactivate Ctrl

API - -> SPA: userDto
deactivate API








@enduml

PlantUML version 1.2022.7(Mon Aug 22 18:01:30 WEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>