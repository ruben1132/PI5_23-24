<?xml version="1.0" encoding="UTF-8" standalone="no"?><svg xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" contentStyleType="text/css" height="551px" preserveAspectRatio="none" style="width:944px;height:551px;background:#FFFFFF;" version="1.1" viewBox="0 0 944 551" width="944px" zoomAndPan="magnify"><defs/><g><rect fill="#FFFFFF" height="460.8594" style="stroke:#181818;stroke-width:1.0;" width="10" x="20.5" y="46.2969"/><rect fill="#FFFFFF" height="430.7266" style="stroke:#181818;stroke-width:1.0;" width="10" x="212.5" y="67.4297"/><rect fill="#FFFFFF" height="330.3281" style="stroke:#181818;stroke-width:1.0;" width="10" x="350.5" y="138.6953"/><rect fill="#FFFFFF" height="187.7969" style="stroke:#181818;stroke-width:1.0;" width="10" x="598.5" y="252.0938"/><rect fill="#FFFFFF" height="64.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="783.5" y="281.2266"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="884" y="381.625"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="25" x2="25" y1="36.2969" y2="516.1563"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="217" x2="217" y1="36.2969" y2="516.1563"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="355" x2="355" y1="36.2969" y2="516.1563"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="603.5" x2="603.5" y1="36.2969" y2="516.1563"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="788" x2="788" y1="36.2969" y2="516.1563"/><line style="stroke:#181818;stroke-width:0.5;stroke-dasharray:5.0,5.0;" x1="889" x2="889" y1="36.2969" y2="516.1563"/><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="41" x="5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="12" y="24.9951">SPA</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="41" x="5" y="515.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="27" x="12" y="535.1514">SPA</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="69" x="183" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="190" y="24.9951">MPT API</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="69" x="183" y="515.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="55" x="190" y="535.1514">MPT API</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="113" x="299" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="306" y="24.9951">UserController</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="113" x="299" y="515.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="99" x="306" y="535.1514">UserController</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96" x="555.5" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="562.5" y="24.9951">UserService</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="96" x="555.5" y="515.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="82" x="562.5" y="535.1514">UserService</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="83" x="747" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="754" y="24.9951">UserRepo</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="83" x="747" y="515.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="69" x="754" y="535.1514">UserRepo</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="98" x="840" y="5"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="847" y="24.9951">UserMapper</text><rect fill="#E2E2F0" height="30.2969" rx="2.5" ry="2.5" style="stroke:#181818;stroke-width:0.5;" width="98" x="840" y="515.1563"/><text fill="#000000" font-family="sans-serif" font-size="14" lengthAdjust="spacing" textLength="84" x="847" y="535.1514">UserMapper</text><rect fill="#FFFFFF" height="460.8594" style="stroke:#181818;stroke-width:1.0;" width="10" x="20.5" y="46.2969"/><rect fill="#FFFFFF" height="430.7266" style="stroke:#181818;stroke-width:1.0;" width="10" x="212.5" y="67.4297"/><rect fill="#FFFFFF" height="330.3281" style="stroke:#181818;stroke-width:1.0;" width="10" x="350.5" y="138.6953"/><rect fill="#FFFFFF" height="187.7969" style="stroke:#181818;stroke-width:1.0;" width="10" x="598.5" y="252.0938"/><rect fill="#FFFFFF" height="64.2656" style="stroke:#181818;stroke-width:1.0;" width="10" x="783.5" y="281.2266"/><rect fill="#FFFFFF" height="29.1328" style="stroke:#181818;stroke-width:1.0;" width="10" x="884" y="381.625"/><polygon fill="#181818" points="200.5,63.4297,210.5,67.4297,200.5,71.4297,204.5,67.4297" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="30.5" x2="206.5" y1="67.4297" y2="67.4297"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="163" x="37.5" y="62.3638">DELETE(/api/users/profile)</text><line style="stroke:#181818;stroke-width:1.0;" x1="222.5" x2="264.5" y1="96.5625" y2="96.5625"/><line style="stroke:#181818;stroke-width:1.0;" x1="264.5" x2="264.5" y1="96.5625" y2="109.5625"/><line style="stroke:#181818;stroke-width:1.0;" x1="223.5" x2="264.5" y1="109.5625" y2="109.5625"/><polygon fill="#181818" points="233.5,105.5625,223.5,109.5625,233.5,113.5625,229.5,109.5625" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="106" x="229.5" y="91.4966">auth middleware</text><polygon fill="#181818" points="338.5,134.6953,348.5,138.6953,338.5,142.6953,342.5,138.6953" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="222.5" x2="344.5" y1="138.6953" y2="138.6953"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="109" x="229.5" y="133.6294">DeleteMyProfile()</text><line style="stroke:#181818;stroke-width:1.0;" x1="360.5" x2="402.5" y1="167.8281" y2="167.8281"/><line style="stroke:#181818;stroke-width:1.0;" x1="402.5" x2="402.5" y1="167.8281" y2="180.8281"/><line style="stroke:#181818;stroke-width:1.0;" x1="361.5" x2="402.5" y1="180.8281" y2="180.8281"/><polygon fill="#181818" points="371.5,176.8281,361.5,180.8281,371.5,184.8281,367.5,180.8281" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="154" x="367.5" y="162.7622">permissions middleware</text><line style="stroke:#181818;stroke-width:1.0;" x1="360.5" x2="402.5" y1="209.9609" y2="209.9609"/><line style="stroke:#181818;stroke-width:1.0;" x1="402.5" x2="402.5" y1="209.9609" y2="222.9609"/><line style="stroke:#181818;stroke-width:1.0;" x1="361.5" x2="402.5" y1="222.9609" y2="222.9609"/><polygon fill="#181818" points="371.5,218.9609,361.5,222.9609,371.5,226.9609,367.5,222.9609" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="103" x="367.5" y="204.895">get current user</text><polygon fill="#181818" points="586.5,248.0938,596.5,252.0938,586.5,256.0938,590.5,252.0938" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="360.5" x2="592.5" y1="252.0938" y2="252.0938"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="219" x="367.5" y="247.0278">DeleteIgnoringActiveAsync(userId)</text><polygon fill="#181818" points="771.5,277.2266,781.5,281.2266,771.5,285.2266,775.5,281.2266" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="608.5" x2="777.5" y1="281.2266" y2="281.2266"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="156" x="615.5" y="276.1606">user = GetByIdAsync(id)</text><polygon fill="#181818" points="771.5,306.3594,781.5,310.3594,771.5,314.3594,775.5,310.3594" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="608.5" x2="777.5" y1="310.3594" y2="310.3594"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="90" x="615.5" y="305.2935">Remove(user)</text><line style="stroke:#181818;stroke-width:1.0;" x1="608.5" x2="650.5" y1="344.4922" y2="344.4922"/><line style="stroke:#181818;stroke-width:1.0;" x1="650.5" x2="650.5" y1="344.4922" y2="357.4922"/><line style="stroke:#181818;stroke-width:1.0;" x1="603.5" x2="650.5" y1="357.4922" y2="357.4922"/><polygon fill="#181818" points="613.5,353.4922,603.5,357.4922,613.5,361.4922,609.5,357.4922" style="stroke:#181818;stroke-width:1.0;"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="99" x="615.5" y="339.4263">CommitAsync()</text><polygon fill="#181818" points="872,377.625,882,381.625,872,385.625,876,381.625" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="608.5" x2="878" y1="381.625" y2="381.625"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="65" x="615.5" y="376.5591">Map(user)</text><polygon fill="#181818" points="619.5,406.7578,609.5,410.7578,619.5,414.7578,615.5,410.7578" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="613.5" x2="888" y1="410.7578" y2="410.7578"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="625.5" y="405.6919">userDto</text><polygon fill="#181818" points="371.5,435.8906,361.5,439.8906,371.5,443.8906,367.5,439.8906" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="365.5" x2="602.5" y1="439.8906" y2="439.8906"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="94" x="377.5" y="434.8247">return userDto</text><polygon fill="#181818" points="233.5,465.0234,223.5,469.0234,233.5,473.0234,229.5,469.0234" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="227.5" x2="354.5" y1="469.0234" y2="469.0234"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="67" x="239.5" y="463.9575">return 200</text><polygon fill="#181818" points="41.5,494.1563,31.5,498.1563,41.5,502.1563,37.5,498.1563" style="stroke:#181818;stroke-width:1.0;"/><line style="stroke:#181818;stroke-width:1.0;" x1="35.5" x2="216.5" y1="498.1563" y2="498.1563"/><text fill="#000000" font-family="sans-serif" font-size="13" lengthAdjust="spacing" textLength="51" x="47.5" y="493.0903">success</text><!--MD5=[841fc7cd1c0c7959e7e48428d0210b9b]
@startuml
participant SPA
participant "MPT API" as API
participant "UserController" as Ctrl
participant "UserService" as Srv
participant "UserRepo" as Repo
participant "UserMapper" as Map


activate SPA
SPA -> API: DELETE(/api/users/profile)
activate API

API -> API: auth middleware
API -> Ctrl: DeleteMyProfile()
activate Ctrl

Ctrl -> Ctrl: permissions middleware
Ctrl -> Ctrl: get current user
Ctrl -> Srv: DeleteIgnoringActiveAsync(userId)
activate Srv

Srv -> Repo: user = GetByIdAsync(id)
activate Repo

Srv -> Repo: Remove(user)
Srv -> Srv: CommitAsync()
deactivate Repo

Srv -> Map: Map(user)
activate Map
Map -> Srv: userDto
deactivate Map

Srv -> Ctrl: return userDto
deactivate Srv
Ctrl -> API: return 200
deactivate Ctrl
API -> SPA: success
deactivate API


@enduml

PlantUML version 1.2022.7(Mon Aug 22 18:01:30 WEST 2022)
(GPL source distribution)
Java Runtime: OpenJDK Runtime Environment
JVM: OpenJDK 64-Bit Server VM
Default Encoding: UTF-8
Language: en
Country: US
--></g></svg>