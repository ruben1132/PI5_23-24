@startuml
participant SPA
participant "MPT API" as API
participant "MP API" as API2
participant "PlanningController" as Ctrl
participant "PlanningService" as Srv
participant "MGI API" as API2
participant "PlanningRepo" as Repo
participant "TaskRepo" as tr
participant "PlanningMapper" as Map
participant "Planning" as Planning
participant "PlanningTask" as pt

activate SPA
SPA -> API: POST(/api/planning/)
activate API

API -> API: auth middleware 
API -> Ctrl: AddAsync(tasks, userId)
activate Ctrl

Ctrl -> Ctrl: permissions middleware 
Ctrl -> Srv: AddAsync(tasks, userId)
activate Srv

Srv -> tr: GetByIdsAsync(taskIds)
activate tr
deactivate tr

Srv -> API2 : planning(tasks)
activate API2
deactivate API2

Srv -> Map : toDomain(userId, 0)
activate Map
Map -> Planning: create
activate Planning
deactivate Planning
deactivate Map

Srv -> Repo: AddAsync(planning)
activate Repo
deactivate Repo

Srv -> Map: toDTO(Planning)
activate Map
deactivate Map

Srv --> Ctrl: PlanningDTO
deactivate Srv

Ctrl --> API: status code 201
deactivate Ctrl

API --> SPA: success
deactivate API


@enduml